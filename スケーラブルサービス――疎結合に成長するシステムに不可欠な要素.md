## スケーラブル

- スケール対象は**開発力**も対象

### スケーリングの懸念点
- スケールアップ
  - ムーアの法則の限界が近づいてて金額で解決すのは難しそう

- スケールダウン
  - 減却償却やリースなど、、、
  - 開発者の能力下げて給料下げるとか、、、

- スケールアウト
  - 人月の神話！！！ 人を増やしても開発スピードは上がらない！

- スケールイン
  - 明日から一人な！！


### 費用対効果
モノリス
↓
モジュラモノリス
↓
マイクロサービス

の順に費用対効果が高い

- 見る範囲が狭いため

## システム観点でのスケーラビリティ

- マイクロサービスの解決策はメッセージ駆動(Kafkaとか)

- メッセージブローカー経由で処理を行うことで、
  - マイクロサービス間の結合を緩めることができる
  - マイクロサービスのスケールアウトが容易になる

- DBの場合はCDC(変更データキャプチャ)

- キューはメッセージを処理をしたら消されるがストリームは機関で管理するためメッセージを次のインスタンスに渡せる

### メッセージ駆動の課題
- 順序保証のためストリームを入れるラインをIDを持たせて同じとこに待たせる
- 処理する側のインスタンスでどっちを処理をするか判別する
- DBトランザクションも複数のVMでは行えない！


## 流量制限と対障害性

- ブローカーを挟んでるのでサービス同士が疎結合になり受け手側で流量制限をかけることができる

- ブローカーがあるとelasticにスケーリングできる

## イベントソーシングとステートソーシング
- ステートソーシングはDBに状態を保存すること
  - どのような実行でこうなったかがわからない

- イベントソーシングはイベントを履歴で保存すること(gitのコミット履歴のようなも音)
  - より詳細な履歴がわかる = 全データが残る！
  - インピーダンスミスマッチを回避できる
  - このイベントを何処かに送信すればよいのでは！！

- イベントジャーナルにイベントをすべて保存しておくことでメッセージ駆動の課題を解決できる

- イベントジャーナルにすべて書かれているので別のサービスについての理解は不要になる

- 履歴をすべて持ってるのでDBをすべて削除しても復帰できる

- バグへの対処がそのまま打ち消しのイベントを追加することで対処できる
  - 影響調査などが不要になる

## 開発力のスケーリング
- KafkaとCQRS+ESを使う！！

- イベントストーミングで仕様を解明できるようにする
  - 人の営みはイベントであるため
  - xx設計書などよりはるかにわかりやすい
  - そのままclass設計にもできる